<head>
	<link rel="stylesheet" href="../style.css">
	<script src="../js/mockups.js"></script>
	<script src="../js/urlParams.js"></script>
	<script src="../js/db.js"></script>
	<style>
		#petImageDisplay{width:50vw;height:50vw;border:solid 1px #888;border-radius:50%;background-size:cover;background-position:50%;margin:0 auto}
		.petSummary{margin-top:0.5rem;color:#555}
		.ownerMeta{font-size:0.9rem;color:#666}
	</style>
	<script>
		async function beforeLoad(){
			let petData=(await selectAllFrom("pets"));
			if("id" in params && params["id"] in (await selectAllFrom("pets"))){
				petData = petData[params["id"]]
				let context = {
					petName:petData["name"],
					petSpecies:petData["species"],
					petBreed:petData["breed"],
					petColor:petData["color"],
					petSex:petData["sex"],
					petImage:petData["images"][0],
					petSexSymbol:(petData["sex"]||'').toLowerCase().startsWith('h')?'♀️':'♂️',
					petSpeciesBreed:`${petData["species"]} (${petData["breed"]})`
				}
				for(let property in context){
					document.body.innerHTML = document.body.innerHTML.replaceAll("${"+property+"}",context[property])
				}

				
			}
			// Vista pública: ocultar "Agregar dueño" y ajustar título
			if((params && (params.view||''))==='public'){
				const titleEl=document.querySelector('#alertTitle');
				if(titleEl){ titleEl.textContent='Mascota encontrada'; }
				const btn=document.querySelector('#addOwnerBtn');
				if(btn){ btn.style.display='none'; }
				const ownerInfo=document.querySelector('#ownerInfo'); if(ownerInfo){ ownerInfo.style.display='none'; }
			}

			// Vista dueño: mostrar "Mi Mascota" como título
			if((params && (params.view||''))==='owner'){
				const titleEl=document.querySelector('#alertTitle');
				if(titleEl){ titleEl.textContent='Mi Mascota'; }
			}

			// Enlazar acciones a páginas dedicadas
			const lossBtn=document.querySelector('#lossAlertBtn');
			if(lossBtn && params && params.id){
				lossBtn.href = 'lossAlert.html?id='+encodeURIComponent(params.id);
			}
			const addBtn=document.querySelector('#addOwnerBtn');
			if(addBtn){
				addBtn.addEventListener('click', async (e)=>{
					e.preventDefault();
					const acc = await selectAllFrom('account');
					if((acc.plan||'free')==='free'){
						window.location.href = 'premiumRequired.html';
					} else {
						const id = params.id ? ('?id='+encodeURIComponent(params.id)) : '';
						window.location.href = 'addOwner.html'+id;
					}
				});
			}
		}
		// Ejecutar también cuando se carga directamente esta página
		window.addEventListener('load', ()=>{ try{ beforeLoad(); }catch(e){} });
	</script>
</head>
<body class="column">
    <div class="row header">
        <button id="backButton" class="column compact"><span class="icon" data-icon="chevron-left"></span></button>
        <h1 id="alertTitle">Mascotas perdidas</h1>
    </div>
	<div class="row flex-grow">
		<div class="column">
			<div class="row"><div id="petImageDisplay" data-imgsrc="../media/${petImage}"></div></div>
			<div class="row">
				<div class="column ta-center size-full-width">
					<h2 class="row ta-center">${petName} ${petSexSymbol}</h2>
					<div class="row ta-center petSummary">${petSpeciesBreed}</div>
				</div>
			</div>
            <div class="row">
                <div class="grid" data-columns=2>
                    <h3 name="petName" colspan=2>${petName}</h3>
                    <span class="ta-left bold">Especie</span>
                    <span class="ta-left" name="petSpecies">${petSpecies}</span>
                    <span class="ta-left bold">Raza</span>
                    <span class="ta-left" name="petBreed">${petBreed}</span>
                    <span class="ta-left bold">Color</span>
                    <span class="ta-left" name="petColor">${petColor}</span>
                    <span class="ta-left bold">Sexo</span>
                    <span class="ta-left" name="petSex">${petSex}</span>
                </div>
            </div>
            <div class="row"><div id="ownerInfo" class="column size-full-width"></div></div>
            <div class="row" id="ownerActions">
                <div class="column size-full-width ph-1">
                    <a id="lossAlertBtn" class="button bg-red" role="button" href="lossAlert.html">Alertar pérdida de mascota</a>
                    <a id="addOwnerBtn" class="button bg-redpale" role="button" href="#">Agregar dueño</a>
                </div>
            </div>
        </div>
    </div>
    
    </body>