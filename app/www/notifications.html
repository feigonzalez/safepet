<head>
	<meta charset="utf-8" />
	<link rel="stylesheet" href="assets/style.css">
	<script src="assets/app.js"></script>
	<script src="assets/connect.js"></script>
	<style>
		.notifItem{display:flex;align-items:flex-start}
		.notifTitle{padding-left:0.5rem}
		.notifIcon{height:2rem;width:2rem}
		.notifMeta{font-size:0.85rem;color:#666;margin-top:0.25rem}
	</style>
	<script>
		async function beforeLoad(){
		
			// Solicita las notificaciones a la API
			
			//notifications = await request("http://dintdt.c1.biz/safepet/pullNotifications.php",{"account_id":0})
			//console.log("Requesting Notifications from server...");
			//notifications = await request("http://localhost/safepet/server/pullNotifications.php",{"account_id":0})
			//console.log("Received.");
			
			//El valor "account_id" debería ser la ID de la cuenta del usuario que inició sesión.

				//Versión insegura
			notifications = await fetch("http://dintdt.c1.biz/safepet/pullNotifications.php",{
				method:"POST",
				body:new URLSearchParams({"account_id":0})
					//El valor "account_id" debería ser la ID de la cuenta del usuario que inició sesión.
			})
				.then(r=>r.ok?r.json():{});


			// Fija el metaText de cada notificación a la timestamp de cuándo se generó la notificación.
			for(let n of notifications){
				n["metaText"]=n.timestamp
			}
		}
		
		/*
		Este código:
		
		feed = await fetch("http://api.allorigins.win/raw?url=https%3A//tenenciaresponsablemascotas.cl/feed/")
			.then(r=>r.ok?r.text():"")
			.then(c=>new window.DOMParser().parseFromString(c, "text/xml"))
		
		usa un servidor proxy para obtener el feed de noticias de tenenciaresponsablemascotas.cl,
		y almacena el XML resultante en la variable "feed".
		TODO: Habría que ver cómo parsear el XML para obtener las noticias como tales, para luego mostrarlas.
		Parece que cada noticia corresponde a un elemento <item> del XML
		*/
		
	</script>
</head>
<body class="column">
	<div class="row header">
		<button id="backButton" class="column compact"><span class="icon" data-icon="chevron-left"></span></button>
		<h1>Notificaciones</h1>
	</div>
	<div class="row">
		<div class="column list size-full-width">
		
			<!-- Este elemento, que tiene un atributo "foreach", se repetirá por cada
			notificación que se encuentre en la variable notifications 
			Cada notificación es un JSON con las llaves "title", "icon", "metaText", y "description"
			Dentro de este elemento, cada vez que aparezca ${X} donde X sea alguna de estas llaves,
			el texto será reemplazado por el valor de esa llave en esa notificación. -->
			
			<div class="row compact card" foreach="notifications">
				<div class="column notifItem ta-left">
					<div class="row ta-left bold">
						<span class="icon notifIcon" data-icon="${type}"></span>
						<span class="notifTitle" content="${title}"></span>
					</div>
					<div class="column ta-left">
						<div class="row ta-left metaText" content="${metaText}"></div>
						<div class="row ta-left" content="${description}"></div>
					</div>
				</div>
			</div>
			
		</div>
	</div>
</body>