<head>
	<meta charset="utf-8" />
	<link rel="stylesheet" href="assets/style.css">
	<script src="assets/app.js"></script>
	<script src="assets/camera.js"></script>
	<script>
		// Función para inicializar el escáner QR cuando se carga la página
		document.addEventListener('DOMContentLoaded', async function() {
			try {
				// Mostrar mensaje de carga
				const cameraBox = document.querySelector('.cameraBox');
				cameraBox.innerHTML = '<p class="ta-center">Iniciando cámara...</p>';
				
				// Iniciar el escáner QR automáticamente
				const qrContent = await CameraManager.showQRScanner();
				
				// Procesar el resultado del QR
				if (qrContent) {
					console.log('QR escaneado:', qrContent);
					
					// Aquí puedes procesar el contenido del QR
					// Por ejemplo, si contiene información de la mascota
					if (qrContent.includes('safepet') || qrContent.includes('pet-id')) {
						// Redirigir al formulario de reporte con datos prellenados
						window.location.href = `reportManual.html?qr=${encodeURIComponent(qrContent)}`;
					} else {
						// Mostrar el contenido del QR y permitir continuar
						alert(`Código QR detectado: ${qrContent}\n\nSerás redirigido al formulario de reporte.`);
						window.location.href = 'reportManual.html';
					}
				}
			} catch (error) {
				console.error('Error al inicializar escáner:', error);
				const cameraBox = document.querySelector('.cameraBox');
				cameraBox.innerHTML = `
					<div class="ta-center">
						<p>Error al inicializar la cámara</p>
						<button class="button bg-red" onclick="location.reload()">Reintentar</button>
						<button class="button" onclick="window.location.href='reportManual.html'">Continuar sin QR</button>
					</div>
				`;
			}
		});
	</script>
</head>

<body class="column">
	<div class="row header">
		<button id="backButton" class="column compact"><span class="icon" data-icon="chevron-left"></span></button>
		<h1>Escáner QR</h1>
	</div>
	<div class="row">
		<div class="column ph-1 size-full-width">
			<div class="cameraBox column size-full-width" aria-label="Cámara"></div>
			<p class="metaText ta-center">Apunta la cámara al QR de la chapa. Al detectar el código, se abrirá el formulario de reporte automáticamente.</p>
		</div>
	</div>
</body>